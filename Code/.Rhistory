installed.packages("rfishbase")
install.packages("rfishbase")
library(rfishbase)
#install.packages("fishtree")
#install.packages("rfishbase")
install.packages("picante")
library(picante)
library(geiger)
?`rfishbase-package`
?rfishbase
fish.tax <- fishtree_taxonomy
fish.tax
length(fish.tax())
fish.tax <- fishtree_taxonomy()
length(fish.tax())
fish.tax <- fishtree_taxonomy()
length(fish.tax)
fish.tax
fish.tax$rank==genus
fish.tax$rank=="genus"
fish.tax$rank=="family"
subet(fish.tax, fish.tax$rank=="genus")
subset(fish.tax, fish.tax$rank=="genus")
fish.app <- subset(fish.tax, fish.tax$rank=="genus")
fish.spp <- subset(fish.tax, fish.tax$rank=="genus")
fish.spp
fish.spp <- subset(fish.tax, rank=="genus")
fish.spp
fish.tax
fish.spp <- subset(fish.tax, rank=="family")
fish.spp
fish.fam
fish.fam <- subset(fish.tax, rank=="family")
fish.fam
fishtree_alignment(Acanthuridae)
fishtree_alignment()
fishtree_phylogeny(Zeidae)
unique(fish.tax$rank)
my.key <- c("30c68b19cedcc7f1cee81aa9b07e1cd235c49d9af8c184d76998b05e59a77c22")
/api/v3/version
install.packages("rredlist")
library(rredlist)
rl_common_names('Loxodonta africana')
rl_common_names('Loxodonta africana', key = my.key)
a.sub <- subset(fish.tax, fish.tax$name=="Actinopterygii")
a.sub
a.sub <- subset(fish.tax, fish.tax$name=="Actinopterygii")
unique(fish.tax)
unique(fish.tax$rank)
head(fish.tax)
fish.names <- rl_common_names(Actinopterygii, key = my.key)
fish.names <- rl_common_names('Actinopterygii', key = my.key)
fish.names
fish.names$name
fish.names$result
fish.names$result$list()
fish.names$result$list
rl_common_names('Actinopterygii', key = my.key)
#clear workspace
rm(list=ls())
graphics.off()
master.db <- data.frame(matrix(ncol=6, nrow = 50000))
colnames(master.db) <- c("All.spp", "FToL.spp", "WoRMS.spp", "RL.spp", "RL.Rank", "GeneticData")
# initialise new frame (required for tidyr)
fishtree <- data.frame()
# subset fishbase for the correct class of fish
act.data <- subset(fishbase, fishbase$Class=="Actinopterygii")
# import all the modules from the test files
source(file = "Documents/CMEECourseWork/ResearchProject/Code/Fishtree_test.R")
source(file = "Documents/CMEECourseWork/ResearchProject/Code/RedList_test.R")
master.db <- data.frame(matrix(ncol=6, nrow = 50000))
colnames(master.db) <- c("All.spp", "FToL.spp", "WoRMS.spp", "RL.spp", "RL.Rank", "GeneticData")
# initialise new frame (required for tidyr)
fishtree <- data.frame()
# subset fishbase for the correct class of fish
act.data <- subset(fishbase, fishbase$Class=="Actinopterygii")
# this creates a new col called GS and combines genus and species
fishtree <- tidyr::unite(act.data, GS, Genus, Species, sep = " ")
fishtree0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(fishtree$GS)))
fishtree.50 <- c()
fishtree.50 <- c(fishtree$GS, fishtree0)
tail(fishtree.50)
master.db$FToL.spp <- fishtree.50
#import whole dataset
redlist.all <- read.csv("Documents/CMEECourseWork/ResearchProject/Data/redlist_species_data_84c02514-9a98-4c0b-92de-465f9605a0e3/assessments.csv", stringsAsFactors = F)
#create vector with just the data we need right now
redlist <- data.frame(matrix(ncol=2, nrow= length(redlist.all$assessmentId)))
colnames(redlist) <- c("RedList.species", "RedList.status")
# create this seperate vector, and make the legnth of the columns the right length
redlist[,1] <- c(redlist.all$scientificName, redlist0)
redlist[,2] <- c(redlist.all$redlistCategory, redlist0)
redlist0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(redlist$RedList.species)))
redlist[,1] <- c(redlist.all$scientificName, redlist0)
#create vector with just the data we need right now
redlist <- data.frame(matrix(ncol=2, nrow= length(master.db$All.spp)))
colnames(redlist) <- c("RedList.species", "RedList.status")
# create this seperate vector, and make the legnth of the columns the right length
redlist0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(redlist$RedList.species)))
redlist[,1] <- c(redlist.all$scientificName, redlist0)
# create this seperate vector, and make the legnth of the columns the right length
redlist0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(redlist.all$assessmentId)))
redlist[,1] <- c(redlist.all$scientificName, redlist0)
redlist[,2] <- c(redlist.all$redlistCategory, redlist0)
master.db$RL.spp <- redlist$RedList.species
master.db$RL.Rank <- redlist$RedList.status
master.spp <- cbind(fishtree$GS, redlist$RedList.species) # THIS DOESN'T WORK YET
master.spp <- c(fishtree$GS, redlist$RedList.species) # THIS DOESN'T WORK YET
## rl_history procedure
trout<-rl_history("Salmo trutta", key = my.key)
View(trout)
trout$
trout$result
trout$result
View(redlist.all)
IUCN<-NULL
for (I in redlist.all$scientificName) {
evaluation  <-rl_history(i, key = my.key)
result<-evaluation$result
result$sci_name<-i
IUCN<-cbind(IUCN,result)
print(i)
}
IUCN<-NULL
for (i in redlist.all$scientificName) {
evaluation  <-rl_history(i, key = my.key)
result<-evaluation$result
result$sci_name<-i
IUCN<-cbind(IUCN,result)
print(i)
}
IUCN<-NULL
for (i in redlist.all$scientificName) {
evaluation  <-rl_history(i, key = my.key)
result<-evaluation$result
result$sci_name<-i
IUCN<-rbind(IUCN,result)
print(i)
}
View(IUCN)
master.spp <- c(fishtree$GS, redlist$RedList.species) # THIS DOESN'T WORK YET
length(master.spp)
master.spp <- c(fishtree$GS, redlist$RedList.species) # THIS DOESN'T WORK YET
length(master.spp) # 81759
#add species from the fish tree
master.spp <- c()
master.spp <- c(fishtree$GS, redlist$RedList.species) # THIS DOESN'T WORK YET
length(master.spp) # 81759
length(unique(master.spp))
all.table <- read.table(file="../Data/WoRMS/taxon.txt", header = T,
sep="\t", fill = T, nrows = 100000 )
setwd("Documents/CMEECourseWork/ResearchProject/Code/")
all.table <- read.table(file="../Data/WoRMS/taxon.txt", header = T,
sep="\t", fill = T, nrows = 50000 )
all.table <- read.table(file="../Data/WoRMS/taxon.txt", header = T,
sep="\t", fill = T, stringsAsFactors = F, nrows = 50000 )
for (x in 1:10) {
batch <- 50000
to.skip <- (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt", header = T,
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch )
total <- c(total, temp)
print(x,"batch is done. wahey!")
}
total <- c()
for (x in 1:10) {
batch <- 50000
to.skip <- (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt", header = T,
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch )
total <- c(total, temp)
print(x,"batch is done. wahey!")
}
for (x in 1:10) {
batch <- 50000
to.skip <- (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt", header = T,
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch )
total <- c(total, temp)
print("batch is done. wahey!")
}
head(total)
Actinop <- subset(total, total$class=="Actinopterygii")
View(total)
a <- read.table(file="../Data/WoRMS/taxon.txt", header = T, sep="\t",
nrows = 5, stringsAsFactors = F, fill = T)
a
View(a)
View(a)
a <- read.table(file="../Data/WoRMS/taxon.txt", header = T, sep="\t",
nrows = 1, stringsAsFactors = F, fill = T)
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 1, stringsAsFactors = F, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 1, stringsAsFactors = F, col.names = T, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 1, stringsAsFactors = F)# col.names = T, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 1, stringsAsFactors = F, col.names = T) #, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 1, stringsAsFactors = F) #, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 1, stringsAsFactors = F, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 1, stringsAsFactors = F, header = T, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 10, stringsAsFactors = F, header = T, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 50, stringsAsFactors = F, header = T, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 50, stringsAsFactors = F, header = T) #, fill = T)
a <- try(read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 50, stringsAsFactors = F, header = T)) #, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 50, stringsAsFactors = F, header = T) #, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 50, stringsAsFactors = F, header = T) #, fill = T)
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 50, stringsAsFactors = F, header = T, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", sep="\t",
nrows = 50, stringsAsFactors = F, header = T, fill = T)
a
head(a)
a <- read.table(file="../Data/WoRMS/taxon.txt",
nrows = 50, stringsAsFactors = F, header = T, fill = T)
head(a)
a <- data.frame()
a <- read.table(file="../Data/WoRMS/taxon.txt",
nrows = 50, stringsAsFactors = F, header = T, fill = T)
head(a)
View(a[40:45,])
a <- read.table(file="../Data/WoRMS/taxon.txt", skip = 20,
nrows = 50, stringsAsFactors = F, header = T, fill = T)
head(a)
View(a[40:45,])
a <- read.table(file="../Data/WoRMS/taxon.txt", rnow = 1, header = T)
a <- read.table(file="../Data/WoRMS/taxon.txt", nrow = 1, header = T)
a <- read.table(file="../Data/WoRMS/taxon.txt", skip = 20,
nrows = 50, stringsAsFactors = F, header = T, fill = T)
a <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 1, header = T)
a <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 1, header = T, fill = T)
a
a <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 1, header = T, fill = T, sep = "\t")
a
b <- rbind(a, read.table(file="../Data/WoRMS/taxon.txt", nrows = 100, skip = 50, fill = T, sep = "\t"))
b <- c(a, read.table(file="../Data/WoRMS/taxon.txt", nrows = 100, skip = 50, fill = T, sep = "\t"))
b <- cbind(a, read.table(file="../Data/WoRMS/taxon.txt", nrows = 100, skip = 50, fill = T, sep = "\t"))
b <- rbind(a, read.table(file="../Data/WoRMS/taxon.txt", nrows = 100, skip = 50, fill = T, sep = "\t"))
c <- read.table(file="../Data/WoRMS/taxon.txt", skip = 20,
nrows = 50, stringsAsFactors = F, fill = T)
d <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 100, skip = 50, header = T, fill = T, sep = "\t")
a <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 1, fill = T, sep = "\t")
colnames(d) <- a
a <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 1, fill = T, sep = "\t")
a
colnames(d) <- a
a <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 1, fill = T, sep = "\t", stringsAsFactors = F)
colnames(d) <- a
View(d)
View(d)
# this is to find the col names (can't do headers when you skip)
a <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 1, fill = T, sep = "\t", stringsAsFactors = F)
# this is a test- read in the first 100 rows (after the skip period)
d <- read.table(file="../Data/WoRMS/taxon.txt", nrows = 100, skip = 50, header = T,
fill = T, sep = "\t", stringsAsFactors = F)
# we then add the col names to the database, which can be explored!
colnames(d) <- a
View(d)
View(d)
#### created a loop to try and read in all of the columns
total <- c()
#### created a loop to try and read in all of the columns
total <- data.frame()
total <- data.frame()
#### created a loop to try and read in all of the columns
temp <- data.frame()
total <- data.frame()
for (x in 1:10) {
batch <- 50000
to.skip <- 50 + (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt",
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch )
total <- c(total, temp)
print(x)
print("batch is done. wahey!")
}
View(total)
total[["V1"]]
tempname <- paste(("batch", x), sep = "")
tempname <- paste("batch", x)
tempname <- gsub(" ", "", tempname)
for (x in 1:10) {
batch <- 50000
to.skip <- 50 + (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt",
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch)
total <- rbind(total, temp)
print(x)
print("batch is done. wahey!")
}
total <- data.frame(matrix(ncol = 32))
for (x in 1:10) {
batch <- 50000
to.skip <- 50 + (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt",
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch)
total <- rbind(total, temp)
print(x)
print("batch is done. wahey!")
}
#### created a loop to try and read in all of the columns
temp <- data.frame()
total <- data.frame(matrix(ncol = 32))
colnames(total) <- a
for (x in 1:10) {
batch <- 50000
to.skip <- 50 + (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt",
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch)
colnames(temp) <- a
total <- rbind(total, temp)
print(x)
print("batch is done. wahey!")
}
View(total)
496984-34
496984-34/10
(496984-34)/10
#### created a loop to try and read in all of the columns in batches of 50k(so we don't freak out )
temp <- data.frame()
total <- data.frame(matrix(ncol = 32))
colnames(total) <- a
for (x in 1:10) {
batch <- 49695
to.skip <- 34 + (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt",
sep="\t", fill = T, stringsAsFactors = F,
skip = to.skip, nrows = batch)
colnames(temp) <- a
total <- rbind(total, temp)
print(x)
print("batch is done. wahey!")
}
#### created a loop to try and read in all of the columns in batches of 50k(so we don't freak out )
temp <- data.frame()
total <- data.frame(matrix(ncol = 32))
colnames(total) <- a
for (x in 1:10) {
batch <- 49695
to.skip <- 34 + (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt",
sep="\t", fill = T, stringsAsFactors = F,
quote = ""
skip = to.skip, nrows = batch)
colnames(temp) <- a
total <- rbind(total, temp)
print(x)
print("batch is done. wahey!")
}
for (x in 1:10) {
batch <- 49695
to.skip <- 34 + (x-1)*batch
temp <- read.table(file="../Data/WoRMS/taxon.txt",
sep="\t",
fill = T,
stringsAsFactors = F,
quote = "",
skip = to.skip, nrows = batch)
colnames(temp) <- a
total <- rbind(total, temp)
print(x)
print("batch is done. wahey!")
}
View(total)
View(total)
Actinop <- subset(total, total$class=="Actinopterygii")
View(Actinop)
Actiop.spp <- subset(Actinop, Actinop$taxonRank=="species")
View(Actiop.spp)
View(Actiop.spp)
usefulcols <- c(6,14,15,16)
usefulcols <- c(6,14,15,16)
WoRMs.use <- Actiop.spp[,usefulcols]
write.csv(Actiop.spp, file = "Full_Actiopterygii_WoRMS_data.csv")
# save this beautiful data down
write.csv(Actiop.spp, file = "../Data/Full_Actiopterygii_WoRMS_data.csv")
Actinop.all <- read.csv(file = "../Data/Full_Actiopterygii_WoRMS_data.csv")
View(Actiop.spp)
View(Actinop.all)
Actinop.all <- Actinop.all[,2:]
Actinop.all <- Actinop.all[,-1]
usefulcols <- c(6,14,15,16)
usefulcols <- c(6,14,15,16)
WoRMs.use <- Actinop.all[,usefulcols]
length(WoRMs.use)
length(WoRMs.use$scientificName)
Worms0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(WoRMs.use$scientificName)))
master.db <- data.frame(matrix(ncol=6, nrow = 50000))
colnames(master.db) <- c("All.spp", "FToL.spp", "WoRMS.spp", "RL.spp", "RL.Rank", "GeneticData")
# initialise new frame (required for tidyr)
fishtree <- data.frame()
# initialise new frame (required for tidyr)
fishtree <- data.frame()
# subset fishbase for the correct class of fish
act.data <- subset(fishbase, fishbase$Class=="Actinopterygii")
library(fishtree)
# initialise new frame (required for tidyr)
fishtree <- data.frame()
# subset fishbase for the correct class of fish
act.data <- subset(fishbase, fishbase$Class=="Actinopterygii")
library(rfishbase)
library(picante)
library(geiger)
library(ape) # analyses of phylogenetics and evolution
library(dplyr)
library(tidyr)
library(ggplot2)
library(rredlist)
# store Red list
my.key <- c("30c68b19cedcc7f1cee81aa9b07e1cd235c49d9af8c184d76998b05e59a77c22")
master.db <- data.frame(matrix(ncol=6, nrow = 50000))
colnames(master.db) <- c("All.spp", "FToL.spp", "WoRMS.spp", "RL.spp", "RL.Rank", "GeneticData")
# initialise new frame (required for tidyr)
fishtree <- data.frame()
# subset fishbase for the correct class of fish
act.data <- subset(fishbase, fishbase$Class=="Actinopterygii")
# this creates a new col called GS and combines genus and species
fishtree <- tidyr::unite(act.data, GS, Genus, Species, sep = " ")
fishtree0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(fishtree$GS)))
fishtree.50 <- c() # initialise a storage vector
fishtree.50 <- c(fishtree$GS, fishtree0)
master.db$FToL.spp <- fishtree.50
#import whole dataset
# this was downloaded from the IUCN website, version 2019-3. If this version number
# changes, then re-download the data (freely available)
redlist.all <- read.csv("Documents/CMEECourseWork/ResearchProject/Data/redlist_species_data_84c02514-9a98-4c0b-92de-465f9605a0e3/assessments.csv", stringsAsFactors = F)
#create data frame to hold the relevant redlist data
redlist <- data.frame(matrix(ncol=2, nrow= length(master.db$All.spp)))
colnames(redlist) <- c("RedList.species", "RedList.status")
# create the zeroes seperate vector, and make the legnth of the columns the right length
redlist0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(redlist.all$assessmentId)))
redlist[,1] <- c(redlist.all$scientificName, redlist0)
redlist[,2] <- c(redlist.all$redlistCategory, redlist0)
master.db$RL.spp <- redlist$RedList.species
# need to be careful here - these rankings will only correspond to the RED list
# species, not the species in any other column
master.db$RL.Rank <- redlist$RedList.status
Actinop.all <- read.csv(file = "../Data/Full_Actiopterygii_WoRMS_data.csv")
Actinop.all <- Actinop.all[,-1]
usefulcols <- c(6,14,15,16)
WoRMs.use <- Actinop.all[,usefulcols]
length(WoRMs.use$scientificName) # 45978
Worms0 <- as.vector(rep(0, length(master.db$FToL.spp)-length(WoRMs.use$scientificName)))
length(Worms0)
Worms50 <- c(WoRMs.use$scientificName, Worms0)
master.db$WoRMS.spp <- Worms50
to.add <- c(fishtree$GS, redlist$RedList.species,WoRMs.use$scientificName) # THIS DOESN'T WORK YET
length(to.add)
to.add <- unique(to.add)
length(to.add) # 33167
# add species referenced in the Red List
length(WoRMs.use$scientificName)
# add species referenced in the Red List
length(WoRMs.use$scientificName)+33167
# add species referenced in the Red List
length(WoRMs.use$scientificName)
all.all <- c(fishtree$GS, redlist$RedList.species,WoRMs.use$scientificName)
length(all.all)
unique.all <- unique(all.all)
length(unique.all) # 33167 # with WoRMS: 77389
sort(unique.all, decreasing = F)
sort(unique.all)
sorted <- sort(unique.all)
sorted <- as.character(sort(unique.all))
sorted <- order(unique.all)
unique.all <- unique(all.all)
sorted <- order(unique.all)
unique.all <- unique(all.all)
unique.all <- unique(all.all)
unique.all <- as.vector(unique(all.all))
length(unique.all) # 33167 # with WoRMS: 77389
sorted <- order(unique.all
sorted <- order(unique.all)
sorted <- order(unique.all)
sorted <- unique.all[order(unique.all)]
unique.all <- as.data.frame(unique(all.all))
length(unique.all) # 33167 # with WoRMS: 77389
colnames(unique.all) <- "All.Species"
length(unique.all$All.Species) # 33167 # with WoRMS: 77389
sorted <- unique.all$All.Species
RLnW <- intersect(fishtree$GS, WoRMs.use$scientificName)
length(RLnW)
RLnW <- intersect(redlist$RedList.species, WoRMs.use$scientificName)
length(RLnW)
